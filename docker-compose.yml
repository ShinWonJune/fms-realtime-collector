services:
  # 실시간 수집기 (외부 서버 사용)
  realtime-collector:
    build: ./realtime-collector
    environment:
      # 외부 Kafka/MinIO 서버 설정
      KAFKA_BROKERS: "10.79.1.1:9094"
      KAFKA_TOPIC: "fms-data"
      KAFKA_GROUP_ID: "realtime-collector"
      MINIO_ENDPOINT: "10.79.1.0:9000"
      MINIO_ACCESS_KEY: "gxQHjrQB9JHKtlIlSYNe"
      MINIO_SECRET_KEY: "Vjsd5McgcZQ9NJ3NS9sThl7gIo1ZXVRfNfLwVJ3N"
      MINIO_BUCKET: "fms-data"
      MINIO_SECURE: "false"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 120s

  # 백필 로더 (외부 서버 사용)
  backfill-loader:
    build: ./backfill-loader
    environment:
      # 외부 Kafka/MinIO 서버 설정
      KAFKA_BROKERS: "10.79.1.1:9094"
      KAFKA_TOPIC: "fms-temphum"
      KAFKA_GROUP_ID: "backfill-loader"
      MINIO_ENDPOINT: "10.79.1.0:9000"
      MINIO_ACCESS_KEY: "gxQHjrQB9JHKtlIlSYNe"
      MINIO_SECRET_KEY: "Vjsd5McgcZQ9NJ3NS9sThl7gIo1ZXVRfNfLwVJ3N"
      MINIO_BUCKET: "fms-temphum"
      MINIO_SECURE: "false"
    restart: "no"  # 백필은 한 번만 실행
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 60s
    # 프로파일을 사용하여 수동 실행 가능하게 설정
    profiles:
      - backfill